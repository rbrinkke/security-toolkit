{
  "analysis_prompt": {
    "role": "You are an expert Linux security analyst AI.",
    "task": "Your goal is to analyze the user-provided security log file located at '/var/log/security-check.log'. You must use the 'system_baseline' and 'analysis_rules' defined within this JSON as your ONLY source of truth for what is normal or abnormal. Do not make assumptions.",
    "steps": [
      {
        "step_1": "Check Log Freshness: Locate the timestamp on the very first line of the '/var/log/security-check.log' file, which looks like '=== SECURITY CHECK YYYY-MM-DD HH:MM:SS ==='. Compare this timestamp to the current date and time. If it is older than 24 hours, your primary finding must be a CRITICAL warning about stale data.",
        "step_2": "Analyze Log Content: Compare the contents of the log file against the 'system_baseline' definitions below.",
        "step_3": "Filter Findings: Use the 'analysis_rules' to decide what to 'focus_on' as a real threat and what to explicitly 'ignore' as normal behavior.",
        "step_4": "Report Status: Provide a final, concise summary. Start your entire response with one of three status levels: 'STATUS: OK', 'STATUS: WARNING', or 'STATUS: CRITICAL'."
      }
    ],
    "output_format": "Provide a brief, bullet-pointed explanation ONLY for WARNING or CRITICAL findings. If the status is OK, simply state that no anomalies were found based on the template."
  },
  "system_baseline": {
    "description": "This defines the expected state for rob-Latitude-5430, an Ubuntu 24.04.3 LTS (Noble Numbat) development workstation running Docker containers for local development (k3d cluster, databases, Prometheus monitoring stack, etc.).",
    "system_type": "development_workstation",
    "hostname": "rob-Latitude-5430",
    "os_version": "Ubuntu 24.04.3 LTS (Noble Numbat)",
    "log_file_location": "/var/log/security-check.log",
    "ufw_firewall": {
      "status": "inactive",
      "explanation": "UFW is intentionally INACTIVE on this development workstation. This is acceptable because it's a laptop behind a home/office router NAT, not a publicly exposed server.",
      "acceptable_states": ["inactive", "active"]
    },
    "docker_security": {
      "expected_behavior": "This is a development machine running a k3d Kubernetes cluster with Prometheus monitoring stack and various database containers for local development. All Docker ports on 0.0.0.0 are NORMAL and EXPECTED.",
      "known_containers": {
        "k3d-activity-local-serverlb": "K3d load balancer - ports 6443, 8080, 8443",
        "k3d-activity-local-server-0": "K3d server node running Kubernetes v1.31.5+k3s1",
        "activity-redis": "Redis cache - port 6379 (requires authentication)",
        "activity-postgres-db": "PostgreSQL database - port 5441",
        "activity-postgres-backup": "PostgreSQL backup container (internal port 5432)",
        "activity-mailhog": "MailHog email testing - ports 1025, 8025",
        "chat-api-mongodb": "MongoDB for chat API - port 27019"
      },
      "kubernetes_services": {
        "prometheus-kube-prometheus-operator": "Prometheus Operator for monitoring",
        "node-exporter": "Node metrics exporter - port 9100",
        "grafana": "Grafana dashboards - accessible via k3d ingress"
      },
      "expected_ports": ["22", "25", "53", "631", "1025", "5037", "5441", "6379", "6443", "8025", "8080", "8443", "9100", "27019"],
      "port_explanations": {
        "22": "SSH server",
        "25": "SMTP (Postfix/local mail)",
        "53": "DNS resolver (systemd-resolved)",
        "631": "CUPS printing service",
        "1025": "MailHog SMTP",
        "5037": "ADB (Android Debug Bridge)",
        "5441": "PostgreSQL database",
        "6379": "Redis cache",
        "6443": "Kubernetes API server (k3d)",
        "8025": "MailHog web UI",
        "8080": "K3d HTTP ingress",
        "8443": "K3d HTTPS ingress",
        "9100": "Prometheus node_exporter",
        "27019": "MongoDB"
      },
      "daemon_config": "Default Docker configuration is acceptable"
    },
    "kubernetes_cluster": {
      "name": "k3d-activity-local",
      "expected_nodes": 1,
      "expected_node_status": "Ready",
      "version": "v1.31.5+k3s1",
      "monitoring_stack": ["prometheus", "grafana", "node-exporter"]
    },
    "ssh_security": {
      "status": "SSH on port 22 is normal for development workstation",
      "expected_failed_attempts": "Low to zero. This is a laptop, not a public server."
    },
    "fail2ban": {
      "status": "optional",
      "explanation": "Fail2ban is OPTIONAL on this development workstation. Not having it installed is acceptable."
    },
    "rkhunter": {
      "status": "optional",
      "explanation": "RKHunter is OPTIONAL on this development workstation. Not having it installed is acceptable.",
      "acceptable_warnings": [
        "RKHunter not installed - skipping rootkit scan",
        "The command '/usr/bin/lwp-request' has been replaced by a script - This is a Perl HTTP client library, normal on Ubuntu",
        "The following suspicious (large) shared memory segments have been found - mutter-x11-frames uses 16MB for GNOME desktop, this is normal",
        "The SSH configuration option 'PermitRootLogin' has not been set - Acceptable for development workstation behind NAT",
        "Hidden directory found: /etc/.java - Normal Java configuration directory",
        "Hidden file found: /etc/.resolv.conf.systemd-resolved.bak - Normal systemd-resolved backup file",
        "Hidden file found: /etc/.updated - Normal system update timestamp file",
        "RKHunter scan completed with warnings - Above warnings are expected on this system"
      ],
      "known_false_positives": {
        "lwp-request": "Perl LWP library HTTP client - part of libwww-perl package",
        "mutter_shared_memory": "GNOME desktop compositor uses large shared memory segments (16MB+)",
        "hidden_etc_files": "systemd-resolved and Java create hidden config/backup files in /etc/",
        "permit_root_login": "SSH default config - not a risk on NAT-protected development workstation"
      }
    },
    "localhost_services": {
      "explanation": "Various localhost services are normal for development",
      "expected_localhost_ports": {
        "631": "CUPS printing service",
        "53": "DNS resolver (systemd-resolve, dnsmasq)",
        "5037": "ADB (Android Debug Bridge)",
        "5554-5555": "Android emulator",
        "6402": "Android network simulator (netsimd)",
        "34897": "ADB server",
        "35447": "Dart/Flutter development",
        "42097": "QEMU/Android emulator",
        "43349": "Dart development server"
      }
    }
  },
  "analysis_rules": {
    "focus_on": [
      "CRITICAL: Log file timestamp is older than 24 hours.",
      "CRITICAL: Unexpected processes running as root that are not Docker or system services.",
      "CRITICAL: Unknown network connections to external IPs that are not development-related.",
      "CRITICAL: Kubernetes node is NotReady or missing.",
      "CRITICAL: Database (Redis/MongoDB/PostgreSQL) connectivity failure.",
      "WARNING: A large number of failed SSH attempts (more than 10 in the log).",
      "WARNING: A new Docker container listening on a port NOT in the expected_ports list.",
      "WARNING: Suspicious processes or unknown services.",
      "WARNING: RKHunter detects actual rootkit signatures (if installed).",
      "WARNING: Docker container is unhealthy or restarting repeatedly.",
      "WARNING: Prometheus or Grafana monitoring endpoints unreachable."
    ],
    "ignore": [
      "UFW firewall being 'inactive' - this is intentional for development workstation.",
      "Fail2ban not installed or not running - optional for workstation.",
      "RKHunter not installed - optional for workstation.",
      "All Docker ports on 0.0.0.0 that are in the expected_ports list.",
      "SSH running on port 22 - normal for development.",
      "All localhost services (127.0.0.1, 127.0.0.53, 127.0.0.54) - these are local development tools.",
      "Android development tools (ADB, emulator, netsimd, QEMU).",
      "Dart/Flutter development servers.",
      "CUPS printing service on localhost.",
      "dnsmasq on 192.168.122.1 - libvirt/KVM virtual network.",
      "Docker proxy processes - these are normal Docker networking.",
      "RKHunter warning about lwp-request being a Perl script - this is normal.",
      "RKHunter warning about mutter-x11-frames shared memory (16MB) - GNOME desktop normal behavior.",
      "RKHunter warning about PermitRootLogin not set - acceptable for NAT-protected workstation.",
      "RKHunter warning about hidden files in /etc (.java, .resolv.conf.systemd-resolved.bak, .updated) - normal system files.",
      "Port 25 (SMTP) on localhost - local mail delivery.",
      "Port 9100 (node_exporter) - Prometheus metrics collection.",
      "Prometheus operator and related pods in kube-system namespace.",
      "Grafana process running as user 472 - normal Grafana container user.",
      "gcr-ssh-agent process - GNOME Keyring SSH agent.",
      "Redis requiring authentication (NOAUTH response) - this is good security practice."
    ]
  }
}
